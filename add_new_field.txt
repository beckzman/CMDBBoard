# How to Add a New Field to the CMDB
# This document tracks the process and potential bugs when adding new columns.

## Checklist

### 1. Database Layer
[ ] Add column to `ConfigurationItem` class in `backend/app/db/models.py`.
    Example: `service_provider = Column(String(255))`
[ ] Create and run a migration script to update the actual database table.
    See `backend/scripts/migrate_service_provider.py` (to be created) for reference.

### 2. Backend API & Schemas
[ ] Update `CIBase`, `CICreate`, `CIUpdate`, `CIResponse` in `backend/app/schemas.py`.
    Add `service_provider: Optional[str] = None`.
[ ] Update `ExportService` in `backend/app/services/export_service.py` to include the field in CSV/Excel.

### 3. Import Logic
[ ] Check `backend/app/core/import_engine.py`.
    - Update `_create_ci` dictionary to include the new field.
    - Update `_update_ci` logic if special handling is needed (usually handled dynamically by `setattr`).
    - Update `field_mapper.py` (if hardcoded mapping exists) or ensure the config mapping (DB) covers it.
    - Note: SharePoint field names often have `_x0020_` for spaces (e.g., `Service_x0020_Provider`).

### 4. Frontend
[ ] Update `ConfigurationItem` interface in `frontend/src/api/client.ts`.
[ ] Update `ConfigurationItems.tsx`:
    - Add to `AVAILABLE_COLUMNS`.
    - Update `filterableColumns` if you want it filterable.
    - Update `renderCellContent` if it needs special formatting.
[ ] Update `AddCIModal.tsx` / `EditCIModal` forms to include the input field.

## Known Bugs / Gotchas
- **Import Mapping**: SharePoint internal names are tricky. Always check the raw import log.
- **Filter**: If filter dropdown shows "Option", ensure the backend `get_distinct_attribute_values` allows the new field.
- **Sorting**: Ensure the new column key matches the backend model attribute exactly.

